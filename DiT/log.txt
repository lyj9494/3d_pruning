原实验不管是训练还是测试的时候，都把单数时间步的block全都计算一遍

打算把奇数block算一遍的和不算一遍的都跑一下，哪个结果好用哪个，还有算macs的也要写

计划：奇数block算一遍的先弄出来
然后把不算一遍的弄出来
再训练、采样，过程中研究一下block

learning-to-cache ddim-router-20
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 782/782 [1:17:12<00:00,  5.92s/it]
Inception Score: 225.4348602294922
FID: 3.4962573534294847
sFID: 4.6869787833861665
Precision: 0.78972
Recall: 0.5585

TImestep 0: Not Reuse: tensor([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
        18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,
        36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53,
        54, 55])
TImestep 2: Not Reuse: tensor([ 0,  1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
        19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,
        37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54,
        55])
TImestep 4: Not Reuse: tensor([ 0,  1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
        19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,
        37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54,
        55])
TImestep 6: Not Reuse: tensor([ 0,  1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
        19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,
        37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54,
        55])
TImestep 8: Not Reuse: tensor([ 3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
        21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,
        39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 10: Not Reuse: tensor([ 3,  4,  5,  7, 12, 14, 16, 18, 26, 28, 32, 34, 36, 38, 42, 43, 46, 47,
        48, 49, 50, 51, 52, 53, 54, 55])
TImestep 12: Not Reuse: tensor([ 3,  5,  7, 48, 51, 52, 53, 54])
TImestep 14: Not Reuse: tensor([ 4,  7, 54, 55])
TImestep 16: Not Reuse: tensor([], dtype=torch.int64)
TImestep 18: Not Reuse: tensor([], dtype=torch.int64)
Total Activate Layer: 312/560
Total Activate Attention: 157/280
Total Activate MLP: 155/280

[2024-11-01 15:48:48] Experiment directory created at results/006-DiT-XL-2
[2024-11-01 16:40:26] Done!


008-DiT-XL-2/checkpoints/0010000.pt ddim-mask-20--l1 8e-7 batch增大结果反而变差了？

[2024-11-01 21:06:54] Experiment directory created at results/008-DiT-XL-2
[2024-11-01 22:38:22] Done!


009-DiT-XL-2/checkpoints/0010000.pt ddim-mask-20--l1 7e-7

100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 782/782 [1:19:42<00:00,  6.12s/it]

[2024-11-02 08:03:19] Experiment directory created at results/009-DiT-XL-2 保底？
[2024-11-02 08:54:24] Done!

Inception Score: 227.76278686523438
FID: 3.576171546201522
sFID: 5.088447597985692
Precision: 0.79284
Recall: 0.5541


TImestep 0: Not Reuse: tensor([ 4,  5,  7, 50, 53, 54, 55])
TImestep 2: Not Reuse: tensor([ 0,  1,  3,  4,  5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 4: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 6: Not Reuse: tensor([ 1,  4,  5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,
        22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 40,
        41, 42, 43, 45, 46, 47, 48, 49, 50, 51, 52, 53, 55])
TImestep 8: Not Reuse: tensor([ 5,  8, 10, 11, 12, 14, 15, 16, 18, 19, 20, 21, 22, 23, 24, 25, 26, 28,
        29, 30, 31, 32, 34, 36, 37, 38, 40, 42, 43, 45, 46, 47, 48, 51, 52, 53,
        55])
TImestep 10: Not Reuse: tensor([ 2,  4,  5,  6,  7,  8, 10, 11, 12, 14, 18, 20, 21, 22, 24, 26, 28, 29,
        30, 31, 32, 34, 35, 36, 38, 40, 41, 42, 43, 45, 46, 47, 48, 50, 51, 52,
        53, 55])
TImestep 12: Not Reuse: tensor([ 4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 15, 16, 18, 20, 22, 24, 26, 28,
        29, 32, 34, 36, 38, 40, 41, 42, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54,
        55])
TImestep 14: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 18, 26, 32, 34, 36, 38,
        42, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 16: Not Reuse: tensor([ 3,  4,  5,  7, 53, 54, 55])
TImestep 18: Not Reuse: tensor([ 1,  2,  3,  4,  5,  7, 53, 54, 55])
Total Activate Layer: 321/560
Total Activate Attention: 170/280
Total Activate MLP: 151/280


004
if i >= 12:
        loss_scale = 1.5 * loss_scale 
elif i == 0:
        loss_scale = 0.5 * loss_scale

Inception Score: 220.0276336669922
FID: 4.017440503563762
sFID: 5.059343761925788

TImestep 0: Not Reuse: tensor([39, 43, 44, 46, 47, 48, 49, 50, 51, 52, 53, 55])
TImestep 2: Not Reuse: tensor([ 1,  3,  4,  5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
        21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,
        39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 4: Not Reuse: tensor([ 3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
        21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,
        40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 55])
TImestep 6: Not Reuse: tensor([ 1,  5,  8, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
        25, 26, 27, 28, 29, 30, 31, 32, 34, 35, 36, 37, 38, 40, 41, 42, 43, 45,
        46, 47, 48, 50, 51, 52, 53, 55])
TImestep 8: Not Reuse: tensor([ 5,  8, 10, 12, 14, 16, 17, 18, 20, 21, 22, 24, 26, 28, 31, 32, 33, 34,
        36, 38, 41, 42, 43, 45, 46, 47, 51, 52, 53, 55])
TImestep 10: Not Reuse: tensor([ 2,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 17, 18, 19, 20, 21, 22,
        24, 26, 28, 29, 30, 31, 32, 33, 34, 35, 36, 38, 40, 41, 42, 43, 45, 46,
        47, 48, 50, 51, 52, 53, 55])
TImestep 12: Not Reuse: tensor([ 3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 24, 26, 28, 30, 32,
        34, 36, 38, 40, 41, 42, 46, 47, 48, 50, 51, 52, 53, 54, 55])
TImestep 14: Not Reuse: tensor([ 3,  4,  5,  7, 54, 55])
TImestep 16: Not Reuse: tensor([ 3,  4,  5,  7, 53, 54, 55])
TImestep 18: Not Reuse: tensor([ 4,  5,  7, 53, 54, 55])
Total Activate Layer: 285/560
Total Activate Attention: 149/280
Total Activate MLP: 136/280


001

100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 782/782 [1:17:39<00:00,  5.96s/it]

Inception Score: 225.1186981201172
FID: 3.8071676758676176
sFID: 5.148689667866279

TImestep 0: Not Reuse: tensor([ 3,  4,  5,  7, 39, 50, 53, 54, 55])
TImestep 2: Not Reuse: tensor([ 0,  1,  3,  4,  5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 4: Not Reuse: tensor([ 4,  5,  7,  8,  9, 10, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,
        24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 40, 41, 42,
        43, 44, 45, 46, 47, 48, 49, 51, 53, 55])
TImestep 6: Not Reuse: tensor([ 2,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
        21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,
        39, 40, 42, 43, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 8: Not Reuse: tensor([ 5,  8, 10, 11, 12, 14, 15, 16, 18, 20, 22, 24, 26, 28, 30, 31, 32, 34,
        36, 37, 38, 40, 42, 43, 45, 46, 47, 48, 51, 52, 53, 55])
TImestep 10: Not Reuse: tensor([ 2,  5,  7,  8, 10, 11, 12, 14, 16, 18, 20, 21, 22, 24, 26, 28, 29, 30,
        32, 33, 34, 36, 38, 40, 41, 43, 45, 46, 47, 48, 50, 51, 52, 53, 55])
TImestep 12: Not Reuse: tensor([ 3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 19, 20, 22, 23, 24,
        26, 28, 29, 30, 32, 34, 36, 38, 40, 41, 42, 46, 47, 48, 50, 51, 52, 53,
        54, 55])
TImestep 14: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 34, 36, 38, 46, 48, 52, 53,
        54, 55])
TImestep 16: Not Reuse: tensor([ 3,  4,  5,  7, 53, 54, 55])
TImestep 18: Not Reuse: tensor([ 4,  5,  7, 53, 54, 55])
Total Activate Layer: 298/560
Total Activate Attention: 161/280
Total Activate MLP: 137/280

两个想法，第一是照着009改，把7改成7.2试试，稍微加一下loss 结果放在003
第二是照着001改，把7改成6.8试试，减少loss 结果放在002

002

Inception Score: 225.7896728515625
FID: 3.609437829634146
sFID: 4.977643277787479
Precision: 0.79376
Recall: 0.5423

if i >= 16:
        loss_scale = 1.5 * loss_scale 
elif i <= 2:
        loss_scale = 0.5 * loss_scale

TImestep 0: Not Reuse: tensor([ 3,  4,  5,  7, 39, 44, 50, 53, 54, 55])
TImestep 2: Not Reuse: tensor([ 0,  1,  3,  4,  5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 4: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 6: Not Reuse: tensor([ 1,  4,  5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,
        22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 36, 37, 38, 40, 42,
        43, 44, 45, 46, 47, 48, 50, 51, 52, 53, 55])
TImestep 8: Not Reuse: tensor([ 5,  8, 10, 11, 12, 14, 16, 18, 19, 20, 21, 22, 23, 24, 25, 26, 28, 30,
        32, 34, 35, 36, 37, 38, 43, 45, 46, 47, 51, 52, 53, 55])
TImestep 10: Not Reuse: tensor([ 5,  7,  8,  9, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 29, 30, 31, 32,
        33, 34, 36, 38, 42, 46, 48, 50, 51, 52, 53, 55])
TImestep 12: Not Reuse: tensor([ 4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 19, 20, 22, 23, 24, 26,
        28, 29, 30, 32, 34, 36, 38, 40, 41, 42, 45, 46, 47, 48, 49, 50, 51, 52,
        53, 54, 55])
TImestep 14: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 32, 34, 36, 38, 46, 48, 53,
        54, 55])
TImestep 16: Not Reuse: tensor([ 3,  4,  5,  7, 54, 55])
TImestep 18: Not Reuse: tensor([ 4,  5,  7, 53, 54, 55])
Total Activate Layer: 298/560
Total Activate Attention: 160/280
Total Activate MLP: 138/280


003

Inception Score: 225.68905639648438
FID: 3.8236102287541485
sFID: 5.2790591852300395
Precision: 0.79428
Recall: 0.5382

100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 782/782 [1:15:38<00:00,  5.80s/it]

TImestep 0: Not Reuse: tensor([ 4,  5,  7, 39, 50, 53, 54, 55])
TImestep 2: Not Reuse: tensor([ 0,  1,  3,  4,  5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 4: Not Reuse: tensor([ 3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
        21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,
        39, 40, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 6: Not Reuse: tensor([ 1,  5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22,
        23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 34, 35, 36, 37, 38, 40, 41, 42,
        43, 44, 45, 46, 47, 48, 51, 52, 53, 55])
TImestep 8: Not Reuse: tensor([ 5,  7,  8, 10, 11, 12, 14, 15, 17, 18, 20, 21, 22, 24, 26, 28, 30, 31,
        32, 34, 36, 37, 38, 40, 42, 43, 45, 46, 47, 48, 51, 52, 53, 55])
TImestep 10: Not Reuse: tensor([ 5,  8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 32, 33, 34, 36, 37, 38,
        46, 48, 51, 52, 53, 55])
TImestep 12: Not Reuse: tensor([ 2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 19, 20, 22, 24,
        26, 28, 29, 30, 32, 34, 36, 38, 40, 42, 45, 46, 47, 48, 49, 50, 51, 52,
        53, 54, 55])
TImestep 14: Not Reuse: tensor([ 3,  4,  5,  8,  9, 38, 46, 48, 54, 55])
TImestep 16: Not Reuse: tensor([ 3,  4,  5,  7, 53, 54, 55])
TImestep 18: Not Reuse: tensor([ 1,  2,  3,  4,  5,  7, 53, 54, 55])
Total Activate Layer: 283/560
Total Activate Attention: 152/280
Total Activate MLP: 131/280


有提升但没有质的变化，之后不考虑全部置为1的情况


005 目前002表现最好，照着002来，loss改成6e-7

Inception Score: 222.96630859375
FID: 3.904545171506925
sFID: 5.434914976495975
Precision: 0.78816
Recall: 0.5455

if i >= 16:
        loss_scale = 1.5 * loss_scale 
elif i <= 2:
        loss_scale = 0.5 * loss_scale

TImestep 0: Not Reuse: tensor([ 3,  4,  5, 39, 45, 47, 50, 51, 52, 53, 54, 55])
TImestep 2: Not Reuse: tensor([ 0,  1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
        19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,
        37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54,
        55])
TImestep 4: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 55])
TImestep 6: Not Reuse: tensor([ 1,  5,  8, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
        25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 40, 41, 42, 43,
        45, 46, 47, 51, 52, 53, 55])
TImestep 8: Not Reuse: tensor([ 1,  5,  8, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
        25, 26, 27, 28, 29, 30, 31, 32, 34, 35, 36, 37, 38, 40, 42, 43, 45, 46,
        47, 48, 51, 52, 53, 55])
TImestep 10: Not Reuse: tensor([ 2,  5,  7,  8,  9, 10, 11, 12, 14, 16, 18, 20, 21, 22, 24, 26, 28, 29,
        30, 31, 32, 33, 34, 36, 37, 38, 40, 42, 43, 45, 46, 48, 50, 51, 52, 53,
        55])
TImestep 12: Not Reuse: tensor([ 1,  2,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 17, 18, 19, 20, 22,
        23, 24, 26, 28, 29, 30, 32, 34, 36, 38, 40, 41, 42, 43, 45, 46, 47, 48,
        49, 50, 51, 52, 53, 54, 55])
TImestep 14: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 36, 38, 46, 48, 51, 52, 53,
        54, 55])
TImestep 16: Not Reuse: tensor([ 3,  4,  5,  7, 53, 54, 55])
TImestep 18: Not Reuse: tensor([ 2,  3,  4,  5,  7, 53, 54, 55])
Total Activate Layer: 319/560
Total Activate Attention: 162/280
Total Activate MLP: 157/280


效果差了很多

006 loss改成6.5e-7

100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 782/782 [1:20:08<00:00,  6.15s/it]

Inception Score: 224.659912109375
FID: 3.5616695614295963
sFID: 4.759531819946801
Precision: 0.7888
Recall: 0.5585


is降了 fid和sfid略有提升

TImestep 0: Not Reuse: tensor([ 3,  5, 39, 43, 44, 46, 47, 48, 50, 53, 54, 55])
TImestep 2: Not Reuse: tensor([ 0,  1,  3,  4,  5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 4: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 6: Not Reuse: tensor([ 1,  5,  8, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
        25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 40, 41, 42, 43,
        44, 45, 46, 47, 48, 51, 52, 53])
TImestep 8: Not Reuse: tensor([ 0,  1,  2,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
        19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,
        37, 38, 39, 40, 42, 43, 45, 46, 47, 48, 50, 51, 52, 53, 54, 55])
TImestep 10: Not Reuse: tensor([ 5,  7,  8,  9, 10, 11, 12, 14, 16, 18, 20, 22, 24, 26, 28, 29, 30, 31,
        32, 34, 36, 38, 45, 46, 48, 50, 51, 52, 53, 55])
TImestep 12: Not Reuse: tensor([ 3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 19, 20, 22, 24, 26,
        28, 29, 30, 32, 34, 36, 38, 40, 41, 42, 45, 46, 47, 48, 49, 50, 51, 52,
        53, 54, 55])
TImestep 14: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 26, 28, 30, 32,
        34, 36, 38, 40, 42, 46, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 16: Not Reuse: tensor([ 3,  4,  5,  7, 53, 54, 55])
TImestep 18: Not Reuse: tensor([ 4,  5,  7, 53, 54, 55])
Total Activate Layer: 330/560
Total Activate Attention: 177/280
Total Activate MLP: 153/280


007 loss改成6.6e-7

TImestep 0: Not Reuse: tensor([ 3,  5, 39, 45, 47, 50, 51, 52, 53, 54, 55])
TImestep 2: Not Reuse: tensor([ 0,  1,  2,  3,  4,  5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
        19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,
        37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54,
        55])
TImestep 4: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 6: Not Reuse: tensor([ 5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,
        24, 25, 26, 27, 28, 29, 30, 31, 32, 34, 35, 36, 37, 38, 40, 42, 43, 44,
        45, 46, 47, 51, 52, 53, 55])
TImestep 8: Not Reuse: tensor([ 1,  2,  4,  5,  7,  8, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,
        22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 40,
        42, 43, 45, 46, 47, 48, 50, 51, 52, 53, 55])
TImestep 10: Not Reuse: tensor([ 2,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 20, 22, 24, 26, 28, 29,
        30, 31, 32, 33, 34, 36, 38, 42, 45, 46, 48, 50, 51, 52, 53, 55])
TImestep 12: Not Reuse: tensor([ 3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 20, 22, 24, 26, 29,
        30, 32, 34, 36, 38, 40, 41, 42, 45, 46, 47, 48, 50, 51, 52, 53, 54, 55])
TImestep 14: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 26, 28, 30, 32,
        34, 36, 38, 40, 42, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 16: Not Reuse: tensor([ 3,  4,  5,  7, 53, 54, 55])
TImestep 18: Not Reuse: tensor([ 4,  5,  7, 53, 54, 55])
Total Activate Layer: 326/560
Total Activate Attention: 174/280
Total Activate MLP: 152/280


接下来的思路，第一是测一下分阶段的loss 006到底精度怎么样 否则就还是不分阶段（这样的话就没啥加速了）减小loss，或者不做减小，只做增加

008 6.8e-7
if i >= 16:
        loss_scale = 1.5 * loss_scale

Inception Score: 229.0267791748047
FID: 3.3884749009250754
sFID: 5.106333337575393
Precision: 0.79586
Recall: 0.5627

TImestep 0: Not Reuse: tensor([ 3,  5,  7, 50, 53, 54, 55])
TImestep 2: Not Reuse: tensor([ 0,  1,  3,  4,  5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 4: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 6: Not Reuse: tensor([ 1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
        19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,
        37, 38, 39, 40, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 8: Not Reuse: tensor([ 5,  8, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
        26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 40, 42, 43, 45, 46,
        47, 48, 50, 51, 52, 53, 55])
TImestep 10: Not Reuse: tensor([ 0,  2,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 26, 28, 29, 30, 31, 32, 33, 34, 35, 36, 38, 40, 42,
        43, 45, 46, 47, 48, 50, 51, 52, 53, 54, 55])
TImestep 12: Not Reuse: tensor([ 3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 19, 20, 22, 24, 26,
        28, 29, 32, 34, 36, 38, 40, 42, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54,
        55])
TImestep 14: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 22, 26, 28, 30,
        32, 34, 36, 38, 42, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 16: Not Reuse: tensor([ 3,  4,  5,  7, 53, 54, 55])
TImestep 18: Not Reuse: tensor([ 4,  5,  7, 53, 54, 55])
Total Activate Layer: 342/560
Total Activate Attention: 180/280
Total Activate MLP: 162/280

效果很好，基于008改了

005 6.8e-7
if i >= 16:
        loss_scale = 1.5 * loss_scale

100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 782/782 [1:17:44<00:00,  5.96s/it]

Inception Score: 221.99014282226562
FID: 3.9559965646157593
sFID: 5.040089494282711
Precision: 0.78944
Recall: 0.5396

TImestep 0: Not Reuse: tensor([ 3,  4,  5,  7, 50, 53, 54, 55])
TImestep 2: Not Reuse: tensor([ 0,  1,  3,  4,  5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 4: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 6: Not Reuse: tensor([ 5,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
        25, 26, 28, 30, 31, 32, 33, 34, 36, 37, 38, 40, 41, 42, 43, 44, 45, 46,
        47, 48, 51, 52, 53, 55])
TImestep 8: Not Reuse: tensor([ 5,  8, 10, 11, 12, 14, 17, 18, 20, 21, 22, 24, 25, 26, 28, 29, 30, 31,
        32, 33, 34, 36, 37, 38, 41, 42, 43, 45, 46, 47, 51, 52, 53, 55])
TImestep 10: Not Reuse: tensor([ 2,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 15, 16, 18, 20, 21, 22, 24,
        26, 28, 29, 30, 31, 32, 33, 34, 35, 36, 38, 40, 42, 43, 45, 46, 47, 48,
        50, 51, 52, 53, 55])
TImestep 12: Not Reuse: tensor([ 3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 22, 24, 26, 28, 30,
        32, 34, 36, 38, 40, 41, 42, 46, 47, 48, 50, 51, 52, 53, 54, 55])
TImestep 14: Not Reuse: tensor([ 3,  4,  5,  9, 54, 55])
TImestep 16: Not Reuse: tensor([ 3,  4,  5,  7, 53, 54, 55])
TImestep 18: Not Reuse: tensor([ 4,  5,  7, 53, 54, 55])
Total Activate Layer: 286/560
Total Activate Attention: 150/280
Total Activate MLP: 136/280

感觉看着就不行

006 6.8e-7

Inception Score: 223.77365112304688
FID: 3.728164513941522
sFID: 4.874203088746299
Precision: 0.79258
Recall: 0.545

100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 782/782 [1:16:42<00:00,  5.89s/it]

if i >= 16:
        loss_scale = 1.5 * loss_scale
elif i >= 12:
        loss_scale = 1.2 * loss_scale

TImestep 0: Not Reuse: tensor([ 3,  5, 47, 49, 50, 51, 52, 54, 55])
TImestep 2: Not Reuse: tensor([ 0,  1,  3,  4,  5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 4: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 6: Not Reuse: tensor([ 1,  5,  8, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
        25, 26, 27, 28, 29, 30, 31, 32, 34, 35, 36, 37, 38, 40, 42, 43, 44, 45,
        46, 47, 48, 51, 52, 53, 55])
TImestep 8: Not Reuse: tensor([ 5,  8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 32, 34, 35, 36, 38, 43,
        44, 45, 46, 47, 48, 51, 52, 53, 55])
TImestep 10: Not Reuse: tensor([ 0,  1,  2,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 15, 16, 18, 19, 20,
        21, 22, 23, 24, 26, 28, 29, 30, 31, 32, 33, 34, 36, 38, 40, 42, 45, 46,
        47, 48, 50, 51, 52, 53, 55])
TImestep 12: Not Reuse: tensor([ 4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30,
        32, 34, 36, 38, 40, 41, 42, 45, 46, 47, 48, 50, 51, 52, 53, 54, 55])
TImestep 14: Not Reuse: tensor([ 3,  4,  5,  8,  9, 12, 38, 48, 51, 54, 55])
TImestep 16: Not Reuse: tensor([ 3,  4,  5,  7, 53, 54, 55])
TImestep 18: Not Reuse: tensor([ 4,  5,  7, 53, 54, 55])
Total Activate Layer: 289/560
Total Activate Attention: 157/280
Total Activate MLP: 132/280


new 006

100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 782/782 [1:20:47<00:00,  6.20s/it]

TImestep 0: Not Reuse: tensor([ 3,  5,  7, 50, 52, 53, 54, 55])
TImestep 2: Not Reuse: tensor([ 0,  1,  3,  4,  5,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 4: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
        38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 6: Not Reuse: tensor([ 5,  8, 10, 11, 12, 14, 15, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27,
        28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 40, 42, 43, 44, 45, 46, 47,
        48, 51, 52, 53])
TImestep 8: Not Reuse: tensor([ 0,  1,  2,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
        19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 36, 37,
        38, 40, 41, 42, 43, 45, 46, 47, 48, 50, 51, 52, 53, 54, 55])
TImestep 10: Not Reuse: tensor([ 5,  7,  8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 29, 31, 32, 34, 36,
        38, 40, 42, 43, 45, 46, 47, 48, 50, 51, 52, 53, 55])
TImestep 12: Not Reuse: tensor([ 4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 19, 20, 22, 24, 26, 28,
        29, 30, 32, 34, 36, 38, 40, 42, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54,
        55])
TImestep 14: Not Reuse: tensor([ 1,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 14, 16, 18, 22, 26, 28, 30,
        32, 34, 36, 38, 40, 42, 46, 48, 49, 50, 51, 52, 53, 54, 55])
TImestep 16: Not Reuse: tensor([ 3,  4,  5,  7, 53, 54, 55])
TImestep 18: Not Reuse: tensor([ 4,  5,  7, 53, 54, 55])
Total Activate Layer: 321/560
Total Activate Attention: 176/280
Total Activate MLP: 145/280

Inception Score: 229.39480590820312
FID: 3.479022499684447
sFID: 4.812741045129769
Precision: 0.79654
Recall: 0.5534

ori model
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 782/782 [1:36:37<00:00,  7.41s/it]

Inception Score: 221.7021484375
FID: 3.565289215455607
sFID: 4.947783696566944
Precision: 0.7821
Recall: 0.5784


5797s
4632s l2c 1.25
4847s 1.20

17 ddim
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████| 521/521 [55:39<00:00,  6.41s/it] 3gpu
Inception Score: 214.88577270507812
FID: 4.265964440135974
sFID: 5.52192120773384
Precision: 0.77236
Recall: 0.5669

